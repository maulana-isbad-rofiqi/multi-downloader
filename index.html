<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi Downloader - Download Video & Musik Gratis</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚¨áÔ∏è</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0f172a',
                        'secondary': '#1e293b',
                        'accent': '#3b82f6',
                        'neon-blue': '#00d9ff',
                        'neon-purple': '#9d4edd'
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'outfit': ['Outfit', 'sans-serif']
                    },
                    backdropBlur: {
                        'glass': '12px',
                    },
                    boxShadow: {
                        'neon': '0 0 10px theme(colors.neon-blue), 0 0 20px theme(colors.neon-blue)',
                        'neon-purple': '0 0 10px theme(colors.neon-purple), 0 0 20px theme(colors.neon-purple)',
                        'glow': '0 0 15px rgba(59, 130, 246, 0.5)'
                    }
                }
            }
        }
    </script>
    <style>
        * {
            font-family: 'Outfit', sans-serif;
        }
        
        body {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 40% 20%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 80% 0%, rgba(156, 163, 175, 0.15) 0px, transparent 50%),
                radial-gradient(at 0% 50%, rgba(15, 23, 42, 0.3) 0px, transparent 50%),
                radial-gradient(at 80% 50%, rgba(30, 41, 59, 0.3) 0px, transparent 50%);
            min-height: 100vh;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 1rem;
        }
        
        .platform-icon {
            transition: all 0.3s ease;
        }
        
        .platform-icon:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .neon-btn {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }
        
        .neon-btn:hover {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
            border-color: rgba(59, 130, 246, 0.8);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .install-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .thumbnail {
            transition: transform 0.3s ease;
        }
        
        .thumbnail:hover {
            transform: scale(1.02);
        }
    </style>
</head>
<body class="text-white">
    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt hidden">
        <div class="glass-panel rounded-xl p-4 max-w-xs shadow-2xl border border-blue-500/30">
            <div class="flex items-start">
                <div class="mr-3 text-blue-400">
                    <i class="fas fa-download text-xl"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-bold text-sm mb-1">Install Aplikasi</h3>
                    <p class="text-xs text-gray-300 mb-2">Install Multi Downloader untuk akses cepat tanpa browser!</p>
                    <div class="flex gap-2">
                        <button id="installBtn" class="px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-xs font-medium transition">Install</button>
                        <button id="dismissInstall" class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-xs font-medium transition">Nanti</button>
                    </div>
                </div>
                <button id="closeInstall" class="text-gray-400 hover:text-white ml-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass-panel sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-2 rounded-xl shadow-glow">
                        <i class="fas fa-cloud-download-alt text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Multi Downloader</h1>
                        <p class="text-xs text-gray-400">Download video & musik gratis</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button id="aboutBtn" class="neon-btn px-4 py-2 rounded-lg font-medium">
                        <i class="fas fa-info-circle mr-2"></i>Tentang
                    </button>
                    <button id="themeToggle" class="glass-panel p-2 rounded-lg">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Hero Section -->
        <section class="mb-12 text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-4 font-poppins">Download Video & Musik <span class="bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Multi Platform</span></h2>
            <p class="text-gray-400 max-w-2xl mx-auto mb-8">Download konten dari TikTok, YouTube, Instagram, Spotify, Facebook, dan 10+ platform lainnya dengan mudah dan cepat!</p>
            
            <!-- URL Input -->
            <div class="max-w-3xl mx-auto mb-8">
                <div class="glass-panel rounded-2xl p-2 flex">
                    <div class="flex-1">
                        <input type="text" id="urlInput" placeholder="Tempel URL video/musik di sini (Auto Detect Platform)" class="w-full bg-transparent p-4 outline-none text-lg">
                    </div>
                    <button id="downloadBtn" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 px-6 rounded-xl font-bold text-lg flex items-center pulse">
                        <i class="fas fa-download mr-2"></i> Download
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-3 text-left">Contoh: https://www.tiktok.com/@user/video/123456789 | https://youtube.com/watch?v=abc123 | https://open.spotify.com/track/xyz789</p>
            </div>
            
            <!-- Platform Grid -->
            <div class="glass-panel rounded-2xl p-6 mb-8">
                <h3 class="text-2xl font-bold mb-6 text-center">Platform yang Didukung</h3>
                <div class="icon-grid">
                    <!-- TikTok -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="tiktok">
                        <div class="text-3xl mb-2 text-pink-500">
                            <i class="fab fa-tiktok"></i>
                        </div>
                        <p class="text-sm font-medium">TikTok</p>
                    </div>
                    
                    <!-- YouTube -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="youtube">
                        <div class="text-3xl mb-2 text-red-600">
                            <i class="fab fa-youtube"></i>
                        </div>
                        <p class="text-sm font-medium">YouTube</p>
                    </div>
                    
                    <!-- Instagram -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="instagram">
                        <div class="text-3xl mb-2 text-purple-600">
                            <i class="fab fa-instagram"></i>
                        </div>
                        <p class="text-sm font-medium">Instagram</p>
                    </div>
                    
                    <!-- Spotify -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="spotify">
                        <div class="text-3xl mb-2 text-green-500">
                            <i class="fab fa-spotify"></i>
                        </div>
                        <p class="text-sm font-medium">Spotify</p>
                    </div>
                    
                    <!-- Facebook -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="facebook">
                        <div class="text-3xl mb-2 text-blue-600">
                            <i class="fab fa-facebook"></i>
                        </div>
                        <p class="text-sm font-medium">Facebook</p>
                    </div>
                    
                    <!-- Twitter -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="twitter">
                        <div class="text-3xl mb-2 text-blue-400">
                            <i class="fab fa-twitter"></i>
                        </div>
                        <p class="text-sm font-medium">Twitter/X</p>
                    </div>
                    
                    <!-- Pinterest -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="pinterest">
                        <div class="text-3xl mb-2 text-red-500">
                            <i class="fab fa-pinterest"></i>
                        </div>
                        <p class="text-sm font-medium">Pinterest</p>
                    </div>
                    
                    <!-- SoundCloud -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="soundcloud">
                        <div class="text-3xl mb-2 text-orange-500">
                            <i class="fab fa-soundcloud"></i>
                        </div>
                        <p class="text-sm font-medium">SoundCloud</p>
                    </div>
                    
                    <!-- Google Drive -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="gdrive">
                        <div class="text-3xl mb-2 text-green-600">
                            <i class="fab fa-google-drive"></i>
                        </div>
                        <p class="text-sm font-medium">Google Drive</p>
                    </div>
                    
                    <!-- Mediafire -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="mediafire">
                        <div class="text-3xl mb-2 text-yellow-600">
                            <i class="fas fa-cloud"></i>
                        </div>
                        <p class="text-sm font-medium">Mediafire</p>
                    </div>
                    
                    <!-- Apple Music -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="applemusic">
                        <div class="text-3xl mb-2 text-pink-600">
                            <i class="fab fa-apple"></i>
                        </div>
                        <p class="text-sm font-medium">Apple Music</p>
                    </div>
                    
                    <!-- RedNote -->
                    <div class="platform-icon glass-panel rounded-xl p-4 text-center cursor-pointer" data-platform="rednote">
                        <div class="text-3xl mb-2 text-red-400">
                            <i class="fas fa-sticky-note"></i>
                        </div>
                        <p class="text-sm font-medium">RedNote</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Preview Section -->
        <section id="previewSection" class="hidden mb-12 fade-in">
            <div class="glass-panel rounded-2xl p-6">
                <h3 class="text-2xl font-bold mb-6">Preview</h3>
                <div class="flex flex-col md:flex-row gap-8">
                    <!-- Thumbnail -->
                    <div class="md:w-1/3">
                        <div class="rounded-xl overflow-hidden thumbnail">
                            <img id="previewThumbnail" src="" alt="Thumbnail" class="w-full h-64 object-cover">
                        </div>
                        <div class="mt-4 text-center">
                            <p id="platformBadge" class="inline-block px-3 py-1 rounded-full text-sm font-medium bg-blue-900/30 text-blue-400"></p>
                        </div>
                    </div>
                    
                    <!-- Details -->
                    <div class="md:w-2/3">
                        <h4 id="previewTitle" class="text-2xl font-bold mb-4"></h4>
                        <p id="previewDescription" class="text-gray-400 mb-6"></p>
                        
                        <!-- Download Options -->
                        <div class="mb-6">
                            <h5 class="text-lg font-bold mb-4">Pilih Format Download:</h5>
                            <div id="downloadOptions" class="flex flex-wrap gap-4">
                                <!-- Options will be dynamically added here -->
                            </div>
                        </div>
                        
                        <!-- Force Download Button (for CORS issues) -->
                        <div id="forceDownloadSection" class="hidden">
                            <div class="border-l-4 border-yellow-500 pl-4 py-2 mb-4">
                                <p class="text-yellow-400 font-medium"><i class="fas fa-exclamation-triangle mr-2"></i>Jika download tidak berhasil, coba:</p>
                            </div>
                            <button id="forceDownloadBtn" class="neon-btn px-6 py-3 rounded-lg font-bold flex items-center">
                                <i class="fas fa-bolt mr-2"></i> Force Download (Blob Method)
                            </button>
                        </div>
                        
                        <!-- Status -->
                        <div id="statusMessage" class="mt-6"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
            <div class="glass-panel rounded-2xl p-8 flex flex-col items-center">
                <div class="loader mb-4"></div>
                <p class="text-xl font-bold">Memproses...</p>
                <p id="loadingDetail" class="text-gray-400 mt-2 text-center">Mengambil informasi dari platform</p>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
            <div class="glass-panel rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">Tentang Multi Downloader</h3>
                    <button id="closeAbout" class="text-gray-400 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <h4 class="text-xl font-bold mb-3">Fitur Utama</h4>
                        <ul class="space-y-2 text-gray-300">
                            <li class="flex items-start">
                                <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                                <span>Download video dan audio dari 15+ platform populer</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                                <span>Auto-detect platform dari URL yang ditempel</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                                <span>Preview thumbnail dan informasi sebelum download</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                                <span>Pilihan format MP3 dan MP4</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                                <span>Force download untuk mengatasi masalah CORS</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                                <span>Dapat diinstall sebagai PWA (Progressive Web App)</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-xl font-bold mb-3">Cara Menggunakan</h4>
                        <ol class="space-y-3 text-gray-300 list-decimal pl-5">
                            <li>Salin URL video/musik dari platform yang didukung</li>
                            <li>Tempel URL pada input field di halaman utama</li>
                            <li>Klik tombol "Download" atau pilih platform manual</li>
                            <li>Pilih format yang diinginkan (MP3/MP4)</li>
                            <li>Klik tombol download untuk mendapatkan file</li>
                        </ol>
                    </div>
                    
                    <div class="border-t border-gray-700 pt-6">
                        <h4 class="text-xl font-bold mb-3">Credit</h4>
                        <div class="glass-panel rounded-xl p-6">
                            <div class="flex items-center">
                                <div class="mr-4 text-4xl text-blue-400">
                                    <i class="fas fa-code"></i>
                                </div>
                                <div>
                                    <p class="text-lg font-bold">Multi Downloader</p>
                                    <p class="text-gray-400">Dikembangkan dengan ‚ù§Ô∏è menggunakan API publik</p>
                                    <p class="mt-3 font-bold text-lg bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">by „ÄêÔªø ùïÄùï•ùï§ùïìùïíùïï „Äë</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center pt-4">
                        <button id="closeAboutBtn" class="neon-btn px-6 py-3 rounded-lg font-bold">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="glass-panel mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-3">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-2 rounded-xl">
                            <i class="fas fa-cloud-download-alt"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold">Multi Downloader</h2>
                            <p class="text-gray-400 text-sm">Download video & musik multi platform</p>
                        </div>
                    </div>
                </div>
                
                <div class="text-center md:text-right">
                    <p class="text-gray-400 text-sm mb-2">¬© 2023 Multi Downloader. Semua hak dilindungi.</p>
                    <p class="font-bold text-lg bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">by „ÄêÔªø ùïÄùï•ùï§ùïìùïíùïï „Äë</p>
                    <p class="text-gray-500 text-xs mt-2">Gunakan dengan bijak dan hormati hak cipta</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // DOM Elements
        const urlInput = document.getElementById('urlInput');
        const downloadBtn = document.getElementById('downloadBtn');
        const previewSection = document.getElementById('previewSection');
        const previewThumbnail = document.getElementById('previewThumbnail');
        const previewTitle = document.getElementById('previewTitle');
        const previewDescription = document.getElementById('previewDescription');
        const platformBadge = document.getElementById('platformBadge');
        const downloadOptions = document.getElementById('downloadOptions');
        const forceDownloadSection = document.getElementById('forceDownloadSection');
        const forceDownloadBtn = document.getElementById('forceDownloadBtn');
        const statusMessage = document.getElementById('statusMessage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingDetail = document.getElementById('loadingDetail');
        const aboutBtn = document.getElementById('aboutBtn');
        const aboutModal = document.getElementById('aboutModal');
        const closeAbout = document.getElementById('closeAbout');
        const closeAboutBtn = document.getElementById('closeAboutBtn');
        const themeToggle = document.getElementById('themeToggle');
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissInstall = document.getElementById('dismissInstall');
        const closeInstall = document.getElementById('closeInstall');
        const platformIcons = document.querySelectorAll('.platform-icon');

        // Global variables
        let currentPlatform = '';
        let currentData = null;
        let deferredPrompt = null;
        let apiEndpoints = {
            // TikTok APIs
            tiktok: [
                'https://api.ootaizumi.web.id/downloader/tiktok?url=',
                'https://api.ootaizumi.web.id/downloader/ssstiktok?url=',
                'https://api.ootaizumi.web.id/downloader/snaptik?url='
            ],
            // YouTube APIs
            youtube: [
                'https://api.ootaizumi.web.id/downloader/youtube?url=',
                'https://api.ootaizumi.web.id/downloader/youtubev2?url=',
                'https://api.ootaizumi.web.id/downloader/youtube-play?query='
            ],
            // Spotify APIs
            spotify: [
                'https://api.ootaizumi.web.id/downloader/spotify-v2?url=',
                'https://api.ootaizumi.web.id/downloader/spotify?url=',
                'https://api.ootaizumi.web.id/downloader/spotifyplay?query='
            ],
            // Instagram API
            instagram: [
                'https://api.ootaizumi.web.id/downloader/instagram?url='
            ],
            // Facebook API
            facebook: [
                'https://api.ootaizumi.web.id/downloader/facebook?url='
            ],
            // Twitter API
            twitter: [
                'https://api.ootaizumi.web.id/downloader/twitter?url='
            ],
            // Pinterest API
            pinterest: [
                'https://api.ootaizumi.web.id/downloader/pinterest?url='
            ],
            // Telegram Sticker API
            telegram: [
                'https://api.ootaizumi.web.id/downloader/telegram-sticker?url='
            ],
            // RedNote API
            rednote: [
                'https://api.ootaizumi.web.id/downloader/rednote?url='
            ],
            // Google Drive API
            gdrive: [
                'https://api.ootaizumi.web.id/downloader/gdrive?url='
            ],
            // Mediafire API
            mediafire: [
                'https://api.ootaizumi.web.id/downloader/mediafire?url='
            ],
            // Sfile.mobi API
            sfile: [
                'https://api.ootaizumi.web.id/downloader/sfile?url='
            ],
            // Scribd API
            scribd: [
                'https://api.ootaizumi.web.id/downloader/scribd?url='
            ],
            // SoundCloud API
            soundcloud: [
                'https://api.ootaizumi.web.id/downloader/soundcloud?url='
            ],
            // Apple Music API
            applemusic: [
                'https://api.ootaizumi.web.id/downloader/applemusic?url='
            ],
            // NCS Music API
            ncs: [
                'https://api.ootaizumi.web.id/downloader/ncs?tid='
            ]
        };

        // Platform detection patterns
        const platformPatterns = {
            tiktok: /tiktok\.com|vt\.tiktok\.com|vm\.tiktok\.com/,
            youtube: /youtube\.com|youtu\.be/,
            instagram: /instagram\.com/,
            spotify: /spotify\.com/,
            facebook: /facebook\.com|fb\.watch/,
            twitter: /twitter\.com|x\.com/,
            pinterest: /pinterest\.com/,
            telegram: /telegram\.org|t\.me/,
            rednote: /xiaohongshu\.com/,
            gdrive: /drive\.google\.com/,
            mediafire: /mediafire\.com/,
            sfile: /sfile\.mobi/,
            scribd: /scribd\.com/,
            soundcloud: /soundcloud\.com/,
            applemusic: /music\.apple\.com/
        };

        // Platform names for display
        const platformNames = {
            tiktok: 'TikTok',
            youtube: 'YouTube',
            instagram: 'Instagram',
            spotify: 'Spotify',
            facebook: 'Facebook',
            twitter: 'Twitter/X',
            pinterest: 'Pinterest',
            telegram: 'Telegram',
            rednote: 'RedNote (Xiaohongshu)',
            gdrive: 'Google Drive',
            mediafire: 'Mediafire',
            sfile: 'Sfile.mobi',
            scribd: 'Scribd',
            soundcloud: 'SoundCloud',
            applemusic: 'Apple Music',
            ncs: 'NCS Music'
        };

        // Platform colors for badges
        const platformColors = {
            tiktok: 'bg-pink-900/30 text-pink-400',
            youtube: 'bg-red-900/30 text-red-400',
            instagram: 'bg-purple-900/30 text-purple-400',
            spotify: 'bg-green-900/30 text-green-400',
            facebook: 'bg-blue-900/30 text-blue-400',
            twitter: 'bg-sky-900/30 text-sky-400',
            pinterest: 'bg-red-900/30 text-red-400',
            telegram: 'bg-blue-900/30 text-blue-400',
            rednote: 'bg-red-900/30 text-red-400',
            gdrive: 'bg-green-900/30 text-green-400',
            mediafire: 'bg-yellow-900/30 text-yellow-400',
            sfile: 'bg-indigo-900/30 text-indigo-400',
            scribd: 'bg-orange-900/30 text-orange-400',
            soundcloud: 'bg-orange-900/30 text-orange-400',
            applemusic: 'bg-pink-900/30 text-pink-400',
            ncs: 'bg-blue-900/30 text-blue-400'
        };

        // Detect platform from URL
        function detectPlatform(url) {
            for (const platform in platformPatterns) {
                if (platformPatterns[platform].test(url)) {
                    return platform;
                }
            }
            return null;
        }

        // Show loading indicator
        function showLoading(message = 'Memproses...') {
            loadingDetail.textContent = message;
            loadingIndicator.classList.remove('hidden');
        }

        // Hide loading indicator
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
        }

        // Show status message
        function showStatus(type, message) {
            let icon = '';
            let bgColor = '';
            
            switch(type) {
                case 'success':
                    icon = 'fa-check-circle';
                    bgColor = 'bg-green-900/30 text-green-400 border-green-800';
                    break;
                case 'error':
                    icon = 'fa-exclamation-circle';
                    bgColor = 'bg-red-900/30 text-red-400 border-red-800';
                    break;
                case 'warning':
                    icon = 'fa-exclamation-triangle';
                    bgColor = 'bg-yellow-900/30 text-yellow-400 border-yellow-800';
                    break;
                case 'info':
                    icon = 'fa-info-circle';
                    bgColor = 'bg-blue-900/30 text-blue-400 border-blue-800';
                    break;
            }
            
            statusMessage.innerHTML = `
                <div class="${bgColor} border rounded-xl p-4 flex items-start">
                    <i class="fas ${icon} mr-3 mt-1"></i>
                    <div>${message}</div>
                </div>
            `;
        }

        // Clear status message
        function clearStatus() {
            statusMessage.innerHTML = '';
        }

        // Show preview section
        function showPreview(data, platform) {
            currentData = data;
            currentPlatform = platform;
            
            // Set thumbnail
            if (data.thumbnail) {
                previewThumbnail.src = data.thumbnail;
            } else {
                previewThumbnail.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="225" viewBox="0 0 400 225"><rect width="400" height="225" fill="%231e293b"/><text x="200" y="120" font-family="Arial" font-size="24" fill="%234b5563" text-anchor="middle">No thumbnail</text></svg>';
            }
            
            // Set title
            previewTitle.textContent = data.title || 'Judul tidak tersedia';
            
            // Set description
            previewDescription.textContent = data.description || 'Deskripsi tidak tersedia';
            
            // Set platform badge
            platformBadge.textContent = platformNames[platform] || platform;
            platformBadge.className = `inline-block px-3 py-1 rounded-full text-sm font-medium ${platformColors[platform] || 'bg-gray-800 text-gray-400'}`;
            
            // Clear download options
            downloadOptions.innerHTML = '';
            
            // Add download options based on available data
            if (data.video_url || data.url) {
                const videoUrl = data.video_url || data.url;
                
                // MP4 option
                const mp4Option = document.createElement('button');
                mp4Option.className = 'neon-btn px-6 py-3 rounded-lg font-bold flex items-center';
                mp4Option.innerHTML = '<i class="fas fa-file-video mr-2"></i> Download MP4';
                mp4Option.onclick = () => downloadFile(videoUrl, `${data.title || 'video'}.mp4`);
                downloadOptions.appendChild(mp4Option);
            }
            
            if (data.audio_url || data.audio) {
                const audioUrl = data.audio_url || data.audio;
                
                // MP3 option
                const mp3Option = document.createElement('button');
                mp3Option.className = 'neon-btn px-6 py-3 rounded-lg font-bold flex items-center';
                mp3Option.innerHTML = '<i class="fas fa-file-audio mr-2"></i> Download MP3';
                mp3Option.onclick = () => downloadFile(audioUrl, `${data.title || 'audio'}.mp3`);
                downloadOptions.appendChild(mp3Option);
            }
            
            // If no specific options, try to create from available URLs
            if (downloadOptions.children.length === 0 && data.download_url) {
                const genericOption = document.createElement('button');
                genericOption.className = 'neon-btn px-6 py-3 rounded-lg font-bold flex items-center';
                genericOption.innerHTML = '<i class="fas fa-download mr-2"></i> Download File';
                genericOption.onclick = () => downloadFile(data.download_url, `${data.title || 'file'}`);
                downloadOptions.appendChild(genericOption);
            }
            
            // Show preview section
            previewSection.classList.remove('hidden');
            previewSection.classList.add('fade-in');
            
            // Scroll to preview
            previewSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Download file directly
        function downloadFile(url, filename) {
            if (!url) {
                showStatus('error', 'URL download tidak tersedia.');
                return;
            }
            
            showStatus('info', 'Mempersiapkan download...');
            
            // Try direct download first
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // Show force download option in case of CORS issues
            forceDownloadSection.classList.remove('hidden');
            forceDownloadBtn.onclick = () => forceDownload(url, filename);
            
            showStatus('success', 'Download telah dimulai. Jika tidak berhasil, gunakan tombol Force Download.');
        }

        // Force download using blob (for CORS issues)
        async function forceDownload(url, filename) {
            showLoading('Menggunakan metode Force Download...');
            
            try {
                const response = await fetch(url, { mode: 'cors' });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Clean up
                window.URL.revokeObjectURL(blobUrl);
                
                hideLoading();
                showStatus('success', 'Force download berhasil! File sedang disimpan.');
            } catch (error) {
                hideLoading();
                console.error('Force download error:', error);
                showStatus('error', `Gagal force download: ${error.message}`);
            }
        }

        // Process URL with API
        async function processURL(url, platform = null) {
            if (!url.trim()) {
                showStatus('error', 'Masukkan URL terlebih dahulu.');
                return;
            }
            
            // Detect platform if not specified
            if (!platform) {
                platform = detectPlatform(url);
                if (!platform) {
                    showStatus('error', 'Platform tidak dikenali. Pastikan URL valid atau pilih platform manual.');
                    return;
                }
            }
            
            showLoading(`Mengambil data dari ${platformNames[platform] || platform}...`);
            clearStatus();
            
            // Get API endpoints for the platform
            const endpoints = apiEndpoints[platform];
            if (!endpoints || endpoints.length === 0) {
                hideLoading();
                showStatus('error', `API untuk platform ${platform} tidak tersedia.`);
                return;
            }
            
            let success = false;
            let result = null;
            
            // Try each endpoint until one works
            for (let i = 0; i < endpoints.length; i++) {
                const endpoint = endpoints[i];
                let apiUrl = '';
                
                // Handle special cases
                if (platform === 'youtube' && i === 0) {
                    // YouTube main API needs &format=mp4
                    apiUrl = endpoint + encodeURIComponent(url) + '&format=mp4';
                } else if ((platform === 'youtube' && i === 2) || (platform === 'spotify' && i === 2)) {
                    // Search APIs need query parameter
                    // Extract title or use URL as query
                    const query = url.split('/').pop() || encodeURIComponent(url);
                    apiUrl = endpoint + encodeURIComponent(query);
                } else {
                    // Standard API call
                    apiUrl = endpoint + encodeURIComponent(url);
                }
                
                loadingDetail.textContent = `Mencoba API ${i+1}/${endpoints.length}...`;
                
                try {
                    const response = await fetch(apiUrl, {
                        headers: {
                            'Accept': 'application/json',
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        // Check if API returned valid data
                        if (data && (data.status === 'success' || data.video_url || data.audio_url || data.url)) {
                            result = data;
                            success = true;
                            break;
                        }
                    }
                } catch (error) {
                    console.warn(`API ${i+1} gagal:`, error);
                    // Continue to next API
                }
            }
            
            hideLoading();
            
            if (success) {
                showPreview(result, platform);
                showStatus('success', `Berhasil mengambil data dari ${platformNames[platform] || platform}.`);
            } else {
                showStatus('error', `Gagal mengambil data. Coba lagi nanti atau gunakan platform lain.`);
            }
        }

        // Event Listeners
        downloadBtn.addEventListener('click', () => {
            const url = urlInput.value.trim();
            processURL(url);
        });

        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const url = urlInput.value.trim();
                processURL(url);
            }
        });

        // Platform icon clicks
        platformIcons.forEach(icon => {
            icon.addEventListener('click', () => {
                const platform = icon.getAttribute('data-platform');
                const url = urlInput.value.trim();
                
                if (url) {
                    processURL(url, platform);
                } else {
                    urlInput.focus();
                    showStatus('info', `Pilih platform ${platformNames[platform] || platform}, lalu tempel URL.`);
                }
            });
        });

        // About modal
        aboutBtn.addEventListener('click', () => {
            aboutModal.classList.remove('hidden');
        });

        closeAbout.addEventListener('click', () => {
            aboutModal.classList.add('hidden');
        });

        closeAboutBtn.addEventListener('click', () => {
            aboutModal.classList.add('hidden');
        });

        // Theme toggle (simple dark/light toggle)
        themeToggle.addEventListener('click', () => {
            const icon = themeToggle.querySelector('i');
            if (icon.classList.contains('fa-moon')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                document.body.classList.add('bg-gray-100');
                document.body.classList.remove('bg-primary');
                // Change text colors for light mode
                document.querySelectorAll('.text-white').forEach(el => {
                    el.classList.add('text-gray-900');
                    el.classList.remove('text-white');
                });
                document.querySelectorAll('.text-gray-400').forEach(el => {
                    el.classList.add('text-gray-600');
                    el.classList.remove('text-gray-400');
                });
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                document.body.classList.remove('bg-gray-100');
                document.body.classList.add('bg-primary');
                // Revert to dark mode
                document.querySelectorAll('.text-gray-900').forEach(el => {
                    el.classList.remove('text-gray-900');
                    el.classList.add('text-white');
                });
                document.querySelectorAll('.text-gray-600').forEach(el => {
                    el.classList.remove('text-gray-600');
                    el.classList.add('text-gray-400');
                });
            }
        });

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt after a delay
            setTimeout(() => {
                if (deferredPrompt && !localStorage.getItem('installPromptDismissed')) {
                    installPrompt.classList.remove('hidden');
                }
            }, 3000);
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    installPrompt.classList.add('hidden');
                }
                
                deferredPrompt = null;
            }
        });

        dismissInstall.addEventListener('click', () => {
            installPrompt.classList.add('hidden');
            localStorage.setItem('installPromptDismissed', 'true');
        });

        closeInstall.addEventListener('click', () => {
            installPrompt.classList.add('hidden');
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered: ', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check if already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('Running in standalone mode');
            }
            
            // Auto-focus URL input
            urlInput.focus();
            
            // Example URLs for testing
            urlInput.placeholder = "Tempel URL video/musik di sini (Auto Detect Platform)";
        });
    </script>
</body>
</html>
